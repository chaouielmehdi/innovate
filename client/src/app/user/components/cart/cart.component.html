
<div @fade class="root">

	<!-- Component Header -->
	<div class="row">
		<div class="col-md-12 d-flex justify-content-center align-items-center mb-5">
			<div class="backward">
				<button nz-button nzType="default" (click)="toDashboard()">
					<i nz-icon nzType="dashboard" nzTheme="fill"></i>
					Tableau de bord
				</button>
			</div>

			<div class="mt-5">
				<h4>Mon Panier</h4>
			</div>

		</div>
	</div>
	
	<!-- End Component Header -->
	<div class="center">
		<button (click)="commandClicked()" [disabled]="isCommandDisabled" nz-button nzType="primary">
			Commander
		</button>
		<nz-table #filterTable [nzData]="listOfDisplayData" [nzScroll]="{ x: '500px' }" nzBordered>
			<thead (nzSortChange)="sort($event)" nzSingleSort>
				<tr>
					<th
						nzLeft="0px"
						nzWidth="20px"
					>
					<!-- ------ -->
					</th>
					<th
						nzWidth="300px"
						nzShowSort
						nzSortKey="product.name"
						nzCustomFilter
					>
						Produit
						<nz-dropdown nzTrigger="click" nzPlacement="bottomRight"
							[nzClickHide]="false" nzTableFilter #dropdown
						>
							<i
								nz-icon
								nzType="search"
								class="ant-table-filter-icon"
								[class.ant-table-filter-open]="dropdown.nzVisible"
								nz-dropdown
							></i>
							<div class="search-box">
								<input type="text" autofocus nz-input placeholder="Nom du produit" [(ngModel)]="searchForProduct" />
								<button nz-button nzSize="small" nzType="primary" (click)="search()" class="search-button">
									Chercher
								</button>
								<button nz-button nzSize="small" (click)="resetSearchForProduct()">Réinitialiser</button>
							</div>
						</nz-dropdown>
					</th>
					<th
						nzShowSort
						nzSortKey="product.price"
						nzWidth="300px"
					>
						Prix Unitaire <span class="float-right">x</span>
					</th>
					<th
						nzShowSort
						nzSortKey="quantity"
						nzWidth="150px"
					>
						Quantité <span class="float-right">=</span>
					</th>
					<th
						nzRight="0px"
						nzWidth="300px"
						nzShowSort
						nzSortKey="total_price"
					>
						Prix Total
					</th>
			  </tr>
			</thead>
			<tbody>
				<tr *ngFor="let data of filterTable.data">
					<td
						nzLeft="0px"
						nzShowCheckbox
						[nzDisabled]="data.product.in_store"
						(nzCheckedChange)="check(data.id)"
					>
						<div class="d-inline ml-2">
							<a
								nz-popconfirm
								[nzCancelText]="'Annuler'"
								[nzOkText]="'Supprimer'"
								[nzOkType]="'danger'"
								nzTitle="Êtes-vous sûr de supprimer ce produit ?"
								(nzOnConfirm)="deleteClicked(commandProductQuantity.product.id)"
								nzPlacement="topLeft"
							>
								<i class="fas fa-trash-alt c-pointer c-red"></i>
							</a>
						</div>
					</td>
					<td>
						<span
							(click)="showProductModal(data.product)"
							class="c-pointer c-blue hover-blue"
						>
							{{ data.product.name }}
							<nz-tag *ngIf="data.product.in_store" [nzColor]="'#ff373713'" class="c-red ml-2">
								Non disponible
							</nz-tag>
						</span>
					</td>
					<td>
						<span *ngIf="data.product.sold > 0" class="price-w-sold">
							{{ data.product.price }} <span class="devise">DH</span>
						</span>

						<span>
							{{
								data.product.price - (data.product.price * data.product.sold / 100)
							}}
							<span class="devise">DH</span>
						</span>

						<span class="ml-2" *ngIf="data.product.sold > 0">
							(-{{ data.product.sold }}%)
						</span>

						<span class="float-right">x</span>
					</td>
					<td>
						{{ data.quantity }}
						<span class="float-right">=</span>
					</td>
					<td nzRight="0px">{{ data.total_price }} Dh</td>
				</tr>
			</tbody>
		</nz-table>
	</div>
</div>






<!-- Product Modal -->
<nz-modal
	[nzStyle]="{ top: '40px' }" [nzFooter]="productModalFooter"
	nzTitle="Détails du produit" [(nzVisible)]="isProductModalVisible"
	(nzOnCancel)="handleProductModalCancel()" (nzOnOk)="handleProductModalOk()" 
>
	<!-- Product Carousel -->
	<div class="col-lg-12">
		<div id="carouselExampleIndicators" class="carousel slide" data-ride="carousel">
			<ol class="carousel-indicators">
				<li data-target="#carouselExampleIndicators" data-slide-to="0" class="active"></li>
				<li data-target="#carouselExampleIndicators" data-slide-to="1"></li>
				<li data-target="#carouselExampleIndicators" data-slide-to="2"></li>
			</ol>
			<div class="carousel-inner">
				<div class="carousel-item active">
					<img class="d-block w-100" src="assets/layout/img/products/clean.jpg" alt="First slide">
				</div>
				<div class="carousel-item">
					<img class="d-block w-100" src="assets/layout/img/products/clean.jpg" alt="Second slide">
				</div>
				<div class="carousel-item">
					<img class="d-block w-100" src="assets/layout/img/products/clean.jpg" alt="Third slide">
				</div>
			</div>
			<a class="carousel-control-prev" href="#carouselExampleIndicators" role="button" data-slide="prev">
				<span class="carousel-control-prev-icon" aria-hidden="true"></span>
				<span class="sr-only">Previous</span>
			</a>
			<a class="carousel-control-next" href="#carouselExampleIndicators" role="button" data-slide="next">
				<span class="carousel-control-next-icon" aria-hidden="true"></span>
				<span class="sr-only">Next</span>
			</a>
		</div>
	</div>

	<!-- Product Info -->
	<div class="col-lg-12">
		<div class="">
			<!-- Body -->
			<div class="card-body">
				<h1 class="card-heading card-custom-heading">{{ productModal ? productModal.name : 0 }}</h1>
				
				<div class="">
					<p class="price">
						<span *ngIf="productModal ? productModal.sold > 0 : false" class="price-w-sold">
							{{ productModal ? productModal.price : 0 }} <span class="devise">DH</span>
						</span>
						{{
							productModal
							? ( productModal.price - (productModal.price * productModal.sold / 100) )
							: 0
						}}
						<span class="devise">DH</span>
					</p>
					<p *ngIf="productModal ? productModal.sold > 0 : false">
						(Soldé de <span class="c-blue">{{ productModal ? productModal.sold : 0 }}%</span>)
					</p>
				</div>


				<p class="card-paragraph card-custom-paragraph">{{ productModal ? productModal.desc : 0 }}</p>
				
			</div>

		</div>
	</div>
	<ng-template #productModalFooter>
			<button nz-button nzType="primary" (click)="handleProductModalOk()">Ok</button>
	</ng-template>
</nz-modal>
<!-- End Product Modal -->